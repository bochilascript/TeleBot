"use strict";var F=Object.create;var y=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var S=Object.getPrototypeOf,P=Object.prototype.hasOwnProperty;var A=(e,t,r,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of k(t))!P.call(e,i)&&i!==r&&y(e,i,{get:()=>t[i],enumerable:!(s=v(t,i))||s.enumerable});return e};var u=(e,t,r)=>(r=e!=null?F(S(e)):{},A(t||!e||!e.__esModule?y(r,"default",{value:e,enumerable:!0}):r,e));var l=u(require("fs")),x=u(require("path"));var O=u(require("https")),z=u(require("http")),p=require("url"),n=u(require("fs"));function b(e,t={}){return new Promise((r,s)=>{let f=(new p.URL(e).protocol==="https:"?O:z).get(e,t,a=>{if(a.statusCode>=300&&a.statusCode<400&&a.headers.location){let h=new p.URL(a.headers.location,e).toString();b(h,t).then(r).catch(s);return}r(a)});f.on("error",s),f.setTimeout(3e4,()=>{f.destroy(),s(new Error("Request timed out"))})})}async function m(e,t){try{let r=n.createWriteStream(t),s=await b(e);if(s.statusCode!==200)throw r.close(),n.unlinkSync(t),new Error(`Failed to download file: ${s.statusCode} ${s.statusMessage}`);let i=parseInt(s.headers["content-length"]||"0",10),d=0;return s.on("data",f=>{d+=f.length;let a=d/i*100;process.stdout.write(`Progress: ${Math.round(a)}%\r`)}),s.pipe(r),new Promise((f,a)=>{r.on("finish",()=>{r.close(),console.log(`
Download complete!`),f()}),r.on("error",h=>{r.close(),n.unlinkSync(t),a(h)}),s.on("error",h=>{r.close(),n.unlinkSync(t),a(h)})})}catch(r){throw n.existsSync(t)&&n.unlinkSync(t),r}}var w=u(require("path"));var c=w.join(__dirname,"..","bin");var T="https://github.com/yt-dlp/yt-dlp/releases/latest/download",g={win32:{x64:"yt-dlp.exe",ia32:"yt-dlp_x86.exe"},linux:{x64:"yt-dlp",armv7l:"yt-dlp_linux_armv7l",aarch64:"yt-dlp_linux_aarch64"},darwin:{x64:"yt-dlp_macos",arm64:"yt-dlp_macos"}};function I(){let e=process.platform,t=process.arch;if(!g[e]||!g[e][t])throw new Error(`No FFmpeg build available for ${e} ${t}`);return g[e][t]}async function B(){let e=I(),t=`${T}/${e}`,r=x.join(c,e);if(l.existsSync(r))return r;console.log("Downloading yt-dlp...",t),l.existsSync(c)||l.mkdirSync(c,{recursive:!0});try{await m(t,r),console.log(`yt-dlp downloaded successfully to: ${r}`);try{l.chmodSync(r,493)}catch{console.log("Error while chmod")}return r}catch(i){throw console.error(`Download failed: ${i}`),i}}B().catch(e=>{console.error("Failed to download yt-dlp:",e),process.exit(1)});
